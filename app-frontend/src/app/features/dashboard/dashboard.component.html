<div class="dashboard-container">
  <!-- Toolbar -->
  <mat-toolbar color="primary" class="toolbar-gradient">
    <span class="toolbar-title">Task Management</span>
    <span class="spacer"></span>

    <!-- User Menu -->
    <button mat-icon-button [matMenuTriggerFor]="userMenu">
      <mat-icon>account_circle</mat-icon>
    </button>
    <mat-menu #userMenu="matMenu">
      <div class="user-info" *ngIf="currentUser()">
        <p class="user-name">{{ currentUser()?.fullName }}</p>
        <p class="user-email">{{ currentUser()?.email }}</p>
        <p class="user-role">{{ currentUser()?.role }}</p>
      </div>
      <mat-divider></mat-divider>
      <button mat-menu-item (click)="logout()">
        <mat-icon>logout</mat-icon>
        <span>Logout</span>
      </button>
    </mat-menu>
  </mat-toolbar>

  <!-- Main Content -->
  <div class="dashboard-content">
    <!-- Welcome Section -->
    <div class="welcome-section" *ngIf="currentUser()">
      <h1>Welcome back, {{ currentUser()?.fullName }}! ðŸ‘‹</h1>
      <p class="text-gray-600">
        You are logged in with <strong>{{ currentUser()?.authProvider }}</strong>
      </p>
    </div>

    <!-- API Test Section -->
    <mat-card class="test-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon class="test-icon">science</mat-icon>
          Backend API Tests
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="test-buttons">
          <button mat-raised-button color="primary" (click)="testHello()" [disabled]="testing()">
            <mat-icon>public</mat-icon>
            Test Public API
          </button>

          <button mat-raised-button color="accent" (click)="testSecure()" [disabled]="testing()">
            <mat-icon>lock</mat-icon>
            Test Secure API
          </button>

          <button mat-raised-button (click)="testHealth()" [disabled]="testing()">
            <mat-icon>favorite</mat-icon>
            Health Check
          </button>

          <button mat-raised-button color="warn" (click)="testEcho()" [disabled]="testing()">
            <mat-icon>repeat</mat-icon>
            Echo Test
          </button>
        </div>

        <!-- Loading Spinner -->
        <div *ngIf="testing()" class="loading-container">
          <mat-spinner diameter="40"></mat-spinner>
          <p>Testing API...</p>
        </div>

        <!-- Test Results -->
        <div *ngIf="testResult()" class="test-result" [ngClass]="{'success': testSuccess(), 'error': !testSuccess()}">
          <div class="result-header">
            <mat-icon>{{ testSuccess() ? 'check_circle' : 'error' }}</mat-icon>
            <strong>{{ testSuccess() ? 'SUCCESS' : 'ERROR' }}</strong>
          </div>
          <pre class="result-json">{{ testResult() | json }}</pre>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Stats Grid -->
    <div class="stats-grid">
      <mat-card class="stat-card">
        <mat-card-content>
          <mat-icon class="stat-icon">task_alt</mat-icon>
          <h3>Tasks</h3>
          <p class="stat-number">0</p>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <mat-icon class="stat-icon">pending_actions</mat-icon>
          <h3>In Progress</h3>
          <p class="stat-number">0</p>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <mat-icon class="stat-icon">check_circle</mat-icon>
          <h3>Completed</h3>
          <p class="stat-number">0</p>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- User Info Card -->
    <mat-card class="info-card" *ngIf="currentUser()">
      <mat-card-header>
        <mat-card-title>Account Information</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="info-row">
          <span class="info-label">Email:</span>
          <span class="info-value">{{ currentUser()?.email }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">Provider:</span>
          <span class="info-value">{{ currentUser()?.authProvider }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">Role:</span>
          <span class="info-value">{{ currentUser()?.role }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">Email Verified:</span>
          <span class="info-value" [ngClass]="{'verified': currentUser()?.emailVerified}">
            <mat-icon>{{ currentUser()?.emailVerified ? 'check_circle' : 'cancel' }}</mat-icon>
            {{ currentUser()?.emailVerified ? 'Verified' : 'Not Verified' }}
          </span>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
